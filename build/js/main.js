"use strict";

var cells = document.querySelectorAll('.cell');
var statusText = document.getElementById('status');
var restartBtn = document.getElementById('restart');
var overlay = document.querySelector(".overlay");
var sideBtns = document.querySelectorAll('.side-btn');
var gameContainer = document.getElementById('game');
var board = ['', '', '', '', '', '', '', '', ''];
var isComputerX = true; // Чередує роль комп'ютера між X та O
var currentPlayer, computerPlayer;
var winningCombos = [[0, 1, 2], [3, 4, 5], [6, 7, 8], [0, 3, 6], [1, 4, 7], [2, 5, 8], [0, 4, 8], [2, 4, 6]];
function initializeGame() {
  currentPlayer = isComputerX ? 'O' : 'X';
  computerPlayer = isComputerX ? 'X' : 'O';
  board = ['', '', '', '', '', '', '', '', ''];
  cells.forEach(function (cell) {
    cell.textContent = '';
    cell.classList.remove('taken');
  });
  statusText.textContent = "\u0412\u0430\u0448 \u0445\u0456\u0434 (".concat(currentPlayer, ")");
  if (currentPlayer === computerPlayer) {
    setTimeout(bestMove, 500);
  }
}
function checkWinner(player) {
  return winningCombos.some(function (combo) {
    return combo.every(function (index) {
      return board[index] === player;
    });
  });
}
function isDraw() {
  return board.every(function (cell) {
    return cell !== '';
  });
}
function bestMove() {
  var bestScore = -Infinity;
  var move;
  for (var i = 0; i < board.length; i++) {
    if (board[i] === '') {
      board[i] = computerPlayer;
      var score = minimax(board, 0, false);
      board[i] = '';
      if (score > bestScore) {
        bestScore = score;
        move = i;
      }
    }
  }
  board[move] = computerPlayer;
  cells[move].textContent = computerPlayer;
  cells[move].classList.add('taken');
  if (checkWinner(computerPlayer)) {
    statusText.textContent = "\u041A\u043E\u043C\u043F'\u044E\u0442\u0435\u0440 (".concat(computerPlayer, ") \u0432\u0438\u0433\u0440\u0430\u0432!");
    showPopup("._lose");
    endGame();
  } else if (isDraw()) {
    showPopup("._draw");
    statusText.textContent = "Нічия!";
  } else {
    currentPlayer = currentPlayer === 'X' ? 'O' : 'X';
    statusText.textContent = "\u0412\u0430\u0448 \u0445\u0456\u0434 (".concat(currentPlayer, ")");
  }
}
function minimax(board, depth, isMaximizing) {
  if (checkWinner(computerPlayer)) return 10 - depth; // Комп'ютер виграв
  if (checkWinner(currentPlayer)) return depth - 10; // Гравець виграв
  if (isDraw()) return 0; // Нічия

  if (isMaximizing) {
    var bestScore = -Infinity;
    for (var i = 0; i < board.length; i++) {
      if (board[i] === '') {
        board[i] = computerPlayer;
        var score = minimax(board, depth + 1, false);
        board[i] = '';
        bestScore = Math.max(score, bestScore);
      }
    }
    return bestScore;
  } else {
    var _bestScore = Infinity;
    for (var _i = 0; _i < board.length; _i++) {
      if (board[_i] === '') {
        board[_i] = currentPlayer;
        var _score = minimax(board, depth + 1, true);
        board[_i] = '';
        _bestScore = Math.min(_score, _bestScore);
      }
    }
    return _bestScore;
  }
}
function handleCellClick(e) {
  var cell = e.target;
  var index = cell.dataset.index;
  if (board[index] === '' && currentPlayer !== computerPlayer) {
    board[index] = currentPlayer;
    cell.textContent = currentPlayer;
    cell.classList.add('taken');
    if (checkWinner(currentPlayer)) {
      statusText.textContent = "\u0412\u0438 (".concat(currentPlayer, ") \u0432\u0438\u0433\u0440\u0430\u043B\u0438!");
      showPopup("._win");
      endGame();
    } else if (isDraw()) {
      showPopup("._draw");
      statusText.textContent = "Нічия!";
    } else {
      currentPlayer = computerPlayer;
      statusText.textContent = "\u0425\u0456\u0434 \u043A\u043E\u043C\u043F'\u044E\u0442\u0435\u0440\u0430 (".concat(computerPlayer, ")");
      setTimeout(bestMove, 500);
    }
  }
}
function endGame() {
  cells.forEach(function (cell) {
    return cell.classList.add('taken');
  });
}
restartBtn.addEventListener('click', function () {
  isComputerX = !isComputerX; // Чередуємо ролі
  initializeGame();
});
cells.forEach(function (cell) {
  return cell.addEventListener('click', handleCellClick);
});
sideBtns.forEach(function (btn) {
  btn.addEventListener('click', function () {
    var side = btn.dataset.side;
    isComputerX = side !== 'X'; // Якщо гравець X, комп'ютер буде O
    document.getElementById('side-selection').style.display = 'none';
    gameContainer.style.display = '';
    restartBtn.style.display = '';
    initializeGame();
  });
});
function showPopup(popup) {
  console.log(popup);
  popup = overlay.querySelector(popup);
  overlay.classList.remove("opacity");
  popup.classList.remove("hide");
}
function hidePopup(popup) {
  popup = overlay.querySelector(popup);
  overlay.classList.add("opacity");
  popup.classList.add("hide");
}
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsiY2VsbHMiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJzdGF0dXNUZXh0IiwiZ2V0RWxlbWVudEJ5SWQiLCJyZXN0YXJ0QnRuIiwib3ZlcmxheSIsInF1ZXJ5U2VsZWN0b3IiLCJzaWRlQnRucyIsImdhbWVDb250YWluZXIiLCJib2FyZCIsImlzQ29tcHV0ZXJYIiwiY3VycmVudFBsYXllciIsImNvbXB1dGVyUGxheWVyIiwid2lubmluZ0NvbWJvcyIsImluaXRpYWxpemVHYW1lIiwiZm9yRWFjaCIsImNlbGwiLCJ0ZXh0Q29udGVudCIsImNsYXNzTGlzdCIsInJlbW92ZSIsInNldFRpbWVvdXQiLCJiZXN0TW92ZSIsImNoZWNrV2lubmVyIiwicGxheWVyIiwic29tZSIsImNvbWJvIiwiZXZlcnkiLCJpbmRleCIsImlzRHJhdyIsImJlc3RTY29yZSIsIkluZmluaXR5IiwibW92ZSIsImkiLCJsZW5ndGgiLCJzY29yZSIsIm1pbmltYXgiLCJhZGQiLCJzaG93UG9wdXAiLCJlbmRHYW1lIiwiZGVwdGgiLCJpc01heGltaXppbmciLCJNYXRoIiwibWF4IiwibWluIiwiaGFuZGxlQ2VsbENsaWNrIiwiZSIsInRhcmdldCIsImRhdGFzZXQiLCJhZGRFdmVudExpc3RlbmVyIiwiYnRuIiwic2lkZSIsInN0eWxlIiwiZGlzcGxheSIsInBvcHVwIiwiY29uc29sZSIsImxvZyIsImhpZGVQb3B1cCJdLCJtYXBwaW5ncyI6Ijs7QUFBQSxJQUFNQSxLQUFLLEdBQUdDLFFBQVEsQ0FBQ0MsZ0JBQWdCLENBQUMsT0FBTyxDQUFDO0FBQ2hELElBQU1DLFVBQVUsR0FBR0YsUUFBUSxDQUFDRyxjQUFjLENBQUMsUUFBUSxDQUFDO0FBQ3BELElBQU1DLFVBQVUsR0FBR0osUUFBUSxDQUFDRyxjQUFjLENBQUMsU0FBUyxDQUFDO0FBQ3JELElBQU1FLE9BQU8sR0FBR0wsUUFBUSxDQUFDTSxhQUFhLENBQUMsVUFBVSxDQUFDO0FBQ2xE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PSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuY2VsbCcpO1xuY29uc3Qgc3RhdHVzVGV4dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdGF0dXMnKTtcbmNvbnN0IHJlc3RhcnRCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGFydCcpO1xuY29uc3Qgb3ZlcmxheSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIub3ZlcmxheVwiKTtcbmNvbnN0IHNpZGVCdG5zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnNpZGUtYnRuJyk7XG5jb25zdCBnYW1lQ29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dhbWUnKTtcblxuXG5sZXQgYm9hcmQgPSBbJycsICcnLCAnJywgJycsICcnLCAnJywgJycsICcnLCAnJ107XG5sZXQgaXNDb21wdXRlclggPSB0cnVlOyAvLyDQp9C10YDQtdC00YPRlCDRgNC+0LvRjCDQutC+0LzQvyfRjtGC0LXRgNCwINC80ZbQtiBYINGC0LAgT1xubGV0IGN1cnJlbnRQbGF5ZXIsIGNvbXB1dGVyUGxheWVyO1xuXG5jb25zdCB3aW5uaW5nQ29tYm9zID0gW1xuICAgIFswLCAxLCAyXSxcbiAgICBbMywgNCwgNV0sXG4gICAgWzYsIDcsIDhdLFxuICAgIFswLCAzLCA2XSxcbiAgICBbMSwgNCwgN10sXG4gICAgWzIsIDUsIDhdLFxuICAgIFswLCA0LCA4XSxcbiAgICBbMiwgNCwgNl0sXG5dO1xuXG5mdW5jdGlvbiBpbml0aWFsaXplR2FtZSgpIHtcbiAgICBjdXJyZW50UGxheWVyID0gaXNDb21wdXRlclggPyAnTycgOiAnWCc7XG4gICAgY29tcHV0ZXJQbGF5ZXIgPSBpc0NvbXB1dGVyWCA/ICdYJyA6ICdPJztcbiAgICBib2FyZCA9IFsnJywgJycsICcnLCAnJywgJycsICcnLCAnJywgJycsICcnXTtcbiAgICBjZWxscy5mb3JFYWNoKGNlbGwgPT4ge1xuICAgICAgICBjZWxsLnRleHRDb250ZW50ID0gJyc7XG4gICAgICAgIGNlbGwuY2xhc3NMaXN0LnJlbW92ZSgndGFrZW4nKTtcbiAgICB9KTtcbiAgICBzdGF0dXNUZXh0LnRleHRDb250ZW50ID0gYNCS0LDRiCDRhdGW0LQgKCR7Y3VycmVudFBsYXllcn0pYDtcbiAgICBpZiAoY3VycmVudFBsYXllciA9PT0gY29tcHV0ZXJQbGF5ZXIpIHtcbiAgICAgICAgc2V0VGltZW91dChiZXN0TW92ZSwgNTAwKTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIGNoZWNrV2lubmVyKHBsYXllcikge1xuICAgIHJldHVybiB3aW5uaW5nQ29tYm9zLnNvbWUoY29tYm8gPT5cbiAgICAgICAgY29tYm8uZXZlcnkoaW5kZXggPT4gYm9hcmRbaW5kZXhdID09PSBwbGF5ZXIpXG4gICAgKTtcbn1cblxuZnVuY3Rpb24gaXNEcmF3KCkge1xuICAgIHJldHVybiBib2FyZC5ldmVyeShjZWxsID0+IGNlbGwgIT09ICcnKTtcbn1cblxuZnVuY3Rpb24gYmVzdE1vdmUoKSB7XG4gICAgbGV0IGJlc3RTY29yZSA9IC1JbmZpbml0eTtcbiAgICBsZXQgbW92ZTtcblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYm9hcmQubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgaWYgKGJvYXJkW2ldID09PSAnJykge1xuICAgICAgICAgICAgYm9hcmRbaV0gPSBjb21wdXRlclBsYXllcjtcbiAgICAgICAgICAgIGxldCBzY29yZSA9IG1pbmltYXgoYm9hcmQsIDAsIGZhbHNlKTtcbiAgICAgICAgICAgIGJvYXJkW2ldID0gJyc7XG4gICAgICAgICAgICBpZiAoc2NvcmUgPiBiZXN0U2NvcmUpIHtcbiAgICAgICAgICAgICAgICBiZXN0U2NvcmUgPSBzY29yZTtcbiAgICAgICAgICAgICAgICBtb3ZlID0gaTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICBib2FyZFttb3ZlXSA9IGNvbXB1dGVyUGxheWVyO1xuICAgIGNlbGxzW21vdmVdLnRleHRDb250ZW50ID0gY29tcHV0ZXJQbGF5ZXI7XG4gICAgY2VsbHNbbW92ZV0uY2xhc3NMaXN0LmFkZCgndGFrZW4nKTtcbiAgICBpZiAoY2hlY2tXaW5uZXIoY29tcHV0ZXJQbGF5ZXIpKSB7XG4gICAgICAgIHN0YXR1c1RleHQudGV4dENvbnRlbnQgPSBg0JrQvtC80L8n0Y7RgtC10YAgKCR7Y29tcHV0ZXJQbGF5ZXJ9KSDQstC40LPRgNCw0LIhYDtcbiAgICAgICAgc2hvd1BvcHVwKFwiLl9sb3NlXCIpXG4gICAgICAgIGVuZEdhbWUoKTtcbiAgICB9IGVsc2UgaWYgKGlzRHJhdygpKSB7XG4gICAgICAgIHNob3dQb3B1cChcIi5fZHJhd1wiKVxuICAgICAgICBzdGF0dXNUZXh0LnRleHRDb250ZW50ID0gXCLQndGW0YfQuNGPIVwiO1xuXG4gICAgfSBlbHNlIHtcbiAgICAgICAgY3VycmVudFBsYXllciA9IGN1cnJlbnRQbGF5ZXIgPT09ICdYJyA/ICdPJyA6ICdYJztcbiAgICAgICAgc3RhdHVzVGV4dC50ZXh0Q29udGVudCA9IGDQktCw0Ygg0YXRltC0ICgke2N1cnJlbnRQbGF5ZXJ9KWA7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBtaW5pbWF4KGJvYXJkLCBkZXB0aCwgaXNNYXhpbWl6aW5nKSB7XG4gICAgaWYgKGNoZWNrV2lubmVyKGNvbXB1dGVyUGxheWVyKSkgcmV0dXJuIDEwIC0gZGVwdGg7IC8vINCa0L7QvNC/J9GO0YLQtdGAINCy0LjQs9GA0LDQslxuICAgIGlmIChjaGVja1dpbm5lcihjdXJyZW50UGxheWVyKSkgcmV0dXJuIGRlcHRoIC0gMTA7IC8vINCT0YDQsNCy0LXRhtGMINCy0LjQs9GA0LDQslxuICAgIGlmIChpc0RyYXcoKSkgcmV0dXJuIDA7IC8vINCd0ZbRh9C40Y9cblxuICAgIGlmIChpc01heGltaXppbmcpIHtcbiAgICAgICAgbGV0IGJlc3RTY29yZSA9IC1JbmZpbml0eTtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBib2FyZC5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgaWYgKGJvYXJkW2ldID09PSAnJykge1xuICAgICAgICAgICAgICAgIGJvYXJkW2ldID0gY29tcHV0ZXJQbGF5ZXI7XG4gICAgICAgICAgICAgICAgbGV0IHNjb3JlID0gbWluaW1heChib2FyZCwgZGVwdGggKyAxLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgYm9hcmRbaV0gPSAnJztcbiAgICAgICAgICAgICAgICBiZXN0U2NvcmUgPSBNYXRoLm1heChzY29yZSwgYmVzdFNjb3JlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYmVzdFNjb3JlO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIGxldCBiZXN0U2NvcmUgPSBJbmZpbml0eTtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBib2FyZC5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgaWYgKGJvYXJkW2ldID09PSAnJykge1xuICAgICAgICAgICAgICAgIGJvYXJkW2ldID0gY3VycmVudFBsYXllcjtcbiAgICAgICAgICAgICAgICBsZXQgc2NvcmUgPSBtaW5pbWF4KGJvYXJkLCBkZXB0aCArIDEsIHRydWUpO1xuICAgICAgICAgICAgICAgIGJvYXJkW2ldID0gJyc7XG4gICAgICAgICAgICAgICAgYmVzdFNjb3JlID0gTWF0aC5taW4oc2NvcmUsIGJlc3RTY29yZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGJlc3RTY29yZTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIGhhbmRsZUNlbGxDbGljayhlKSB7XG4gICAgY29uc3QgY2VsbCA9IGUudGFyZ2V0O1xuICAgIGNvbnN0IGluZGV4ID0gY2VsbC5kYXRhc2V0LmluZGV4O1xuXG4gICAgaWYgKGJvYXJkW2luZGV4XSA9PT0gJycgJiYgY3VycmVudFBsYXllciAhPT0gY29tcHV0ZXJQbGF5ZXIpIHtcbiAgICAgICAgYm9hcmRbaW5kZXhdID0gY3VycmVudFBsYXllcjtcbiAgICAgICAgY2VsbC50ZXh0Q29udGVudCA9IGN1cnJlbnRQbGF5ZXI7XG4gICAgICAgIGNlbGwuY2xhc3NMaXN0LmFkZCgndGFrZW4nKTtcblxuICAgICAgICBpZiAoY2hlY2tXaW5uZXIoY3VycmVudFBsYXllcikpIHtcbiAgICAgICAgICAgIHN0YXR1c1RleHQudGV4dENvbnRlbnQgPSBg0JLQuCAoJHtjdXJyZW50UGxheWVyfSkg0LLQuNCz0YDQsNC70LghYDtcbiAgICAgICAgICAgIHNob3dQb3B1cChcIi5fd2luXCIpXG4gICAgICAgICAgICBlbmRHYW1lKCk7XG4gICAgICAgIH0gZWxzZSBpZiAoaXNEcmF3KCkpIHtcbiAgICAgICAgICAgIHNob3dQb3B1cChcIi5fZHJhd1wiKVxuICAgICAgICAgICAgc3RhdHVzVGV4dC50ZXh0Q29udGVudCA9IFwi0J3RltGH0LjRjyFcIjtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGN1cnJlbnRQbGF5ZXIgPSBjb21wdXRlclBsYXllcjtcbiAgICAgICAgICAgIHN0YXR1c1RleHQudGV4dENvbnRlbnQgPSBg0KXRltC0INC60L7QvNC/J9GO0YLQtdGA0LAgKCR7Y29tcHV0ZXJQbGF5ZXJ9KWA7XG4gICAgICAgICAgICBzZXRUaW1lb3V0KGJlc3RNb3ZlLCA1MDApO1xuICAgICAgICB9XG4gICAgfVxufVxuXG5mdW5jdGlvbiBlbmRHYW1lKCkge1xuICAgIGNlbGxzLmZvckVhY2goY2VsbCA9PiBjZWxsLmNsYXNzTGlzdC5hZGQoJ3Rha2VuJykpO1xufVxuXG5yZXN0YXJ0QnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xuICAgIGlzQ29tcHV0ZXJYID0gIWlzQ29tcHV0ZXJYOyAvLyDQp9C10YDQtdC00YPRlNC80L4g0YDQvtC70ZZcbiAgICBpbml0aWFsaXplR2FtZSgpO1xufSk7XG5cbmNlbGxzLmZvckVhY2goY2VsbCA9PiBjZWxsLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgaGFuZGxlQ2VsbENsaWNrKSk7XG5cbnNpZGVCdG5zLmZvckVhY2goYnRuID0+IHtcbiAgICBidG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHNpZGUgPSBidG4uZGF0YXNldC5zaWRlO1xuICAgICAgICBpc0NvbXB1dGVyWCA9IHNpZGUgIT09ICdYJzsgLy8g0K/QutGJ0L4g0LPRgNCw0LLQtdGG0YwgWCwg0LrQvtC80L8n0Y7RgtC10YAg0LHRg9C00LUgT1xuICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2lkZS1zZWxlY3Rpb24nKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuICAgICAgICBnYW1lQ29udGFpbmVyLnN0eWxlLmRpc3BsYXkgPSAnJztcbiAgICAgICAgcmVzdGFydEJ0bi5zdHlsZS5kaXNwbGF5ID0gJyc7XG4gICAgICAgIGluaXRpYWxpemVHYW1lKCk7XG4gICAgfSk7XG59KTtcblxuZnVuY3Rpb24gc2hvd1BvcHVwKHBvcHVwKXtcbiAgICBjb25zb2xlLmxvZyhwb3B1cClcbiAgICBwb3B1cCA9IG92ZXJsYXkucXVlcnlTZWxlY3Rvcihwb3B1cClcblxuICAgIG92ZXJsYXkuY2xhc3NMaXN0LnJlbW92ZShcIm9wYWNpdHlcIilcbiAgICBwb3B1cC5jbGFzc0xpc3QucmVtb3ZlKFwiaGlkZVwiKVxufVxuXG5mdW5jdGlvbiBoaWRlUG9wdXAocG9wdXApe1xuICAgIHBvcHVwID0gb3ZlcmxheS5xdWVyeVNlbGVjdG9yKHBvcHVwKVxuICAgIG92ZXJsYXkuY2xhc3NMaXN0LmFkZChcIm9wYWNpdHlcIilcbiAgICBwb3B1cC5jbGFzc0xpc3QuYWRkKFwiaGlkZVwiKVxufSJdfQ==
