"use strict";

var cells = document.querySelectorAll('.cell');
var statusText = document.getElementById('status');
var restartBtn = document.getElementById('restart');
var overlay = document.querySelector(".overlay");
var board = ['', '', '', '', '', '', '', '', ''];
var isComputerX = true; // Чередує роль комп'ютера між X та O
var currentPlayer, computerPlayer;
var winningCombos = [[0, 1, 2], [3, 4, 5], [6, 7, 8], [0, 3, 6], [1, 4, 7], [2, 5, 8], [0, 4, 8], [2, 4, 6]];
function initializeGame() {
  currentPlayer = isComputerX ? 'O' : 'X';
  computerPlayer = isComputerX ? 'X' : 'O';
  board = ['', '', '', '', '', '', '', '', ''];
  cells.forEach(function (cell) {
    cell.textContent = '';
    cell.classList.remove('taken');
  });
  statusText.textContent = "\u0412\u0430\u0448 \u0445\u0456\u0434 (".concat(currentPlayer, ")");
  if (currentPlayer === computerPlayer) {
    setTimeout(bestMove, 500);
  }
}
function checkWinner(player) {
  return winningCombos.some(function (combo) {
    return combo.every(function (index) {
      return board[index] === player;
    });
  });
}
function isDraw() {
  return board.every(function (cell) {
    return cell !== '';
  });
}
function bestMove() {
  var bestScore = -Infinity;
  var move;
  for (var i = 0; i < board.length; i++) {
    if (board[i] === '') {
      board[i] = computerPlayer;
      var score = minimax(board, 0, false);
      board[i] = '';
      if (score > bestScore) {
        bestScore = score;
        move = i;
      }
    }
  }
  board[move] = computerPlayer;
  cells[move].textContent = computerPlayer;
  cells[move].classList.add('taken');
  if (checkWinner(computerPlayer)) {
    statusText.textContent = "\u041A\u043E\u043C\u043F'\u044E\u0442\u0435\u0440 (".concat(computerPlayer, ") \u0432\u0438\u0433\u0440\u0430\u0432!");
    showPopup("._lose");
    endGame();
  } else if (isDraw()) {
    statusText.textContent = "Нічия!";
    showPopup("._draw");
  } else {
    currentPlayer = currentPlayer === 'X' ? 'O' : 'X';
    statusText.textContent = "\u0412\u0430\u0448 \u0445\u0456\u0434 (".concat(currentPlayer, ")");
  }
}
function minimax(board, depth, isMaximizing) {
  if (checkWinner(computerPlayer)) return 10 - depth; // Комп'ютер виграв
  if (checkWinner(currentPlayer)) return depth - 10; // Гравець виграв
  if (isDraw()) return 0; // Нічия

  if (isMaximizing) {
    var bestScore = -Infinity;
    for (var i = 0; i < board.length; i++) {
      if (board[i] === '') {
        board[i] = computerPlayer;
        var score = minimax(board, depth + 1, false);
        board[i] = '';
        bestScore = Math.max(score, bestScore);
      }
    }
    return bestScore;
  } else {
    var _bestScore = Infinity;
    for (var _i = 0; _i < board.length; _i++) {
      if (board[_i] === '') {
        board[_i] = currentPlayer;
        var _score = minimax(board, depth + 1, true);
        board[_i] = '';
        _bestScore = Math.min(_score, _bestScore);
      }
    }
    return _bestScore;
  }
}
function handleCellClick(e) {
  var cell = e.target;
  var index = cell.dataset.index;
  if (board[index] === '' && currentPlayer !== computerPlayer) {
    board[index] = currentPlayer;
    cell.textContent = currentPlayer;
    cell.classList.add('taken');
    if (checkWinner(currentPlayer)) {
      statusText.textContent = "\u0412\u0438 (".concat(currentPlayer, ") \u0432\u0438\u0433\u0440\u0430\u043B\u0438!");
      showPopup("._win");
      endGame();
    } else if (isDraw()) {
      statusText.textContent = "Нічия!";
    } else {
      currentPlayer = computerPlayer;
      statusText.textContent = "\u0425\u0456\u0434 \u043A\u043E\u043C\u043F'\u044E\u0442\u0435\u0440\u0430 (".concat(computerPlayer, ")");
      setTimeout(bestMove, 500);
    }
  }
}
function endGame() {
  cells.forEach(function (cell) {
    return cell.classList.add('taken');
  });
}
restartBtn.addEventListener('click', function () {
  isComputerX = !isComputerX; // Чередуємо ролі
  initializeGame();
});
cells.forEach(function (cell) {
  return cell.addEventListener('click', handleCellClick);
});
initializeGame();
function showPopup(popup) {
  console.log(popup);
  popup = overlay.querySelector(popup);
  overlay.classList.remove("opacity");
  popup.classList.remove("hide");
}
function hidePopup(popup) {
  popup = overlay.querySelector(popup);
  overlay.classList.add("opacity");
  popup.classList.add("hide");
}
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsiY2VsbHMiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJzdGF0dXNUZXh0IiwiZ2V0RWxlbWVudEJ5SWQiLCJyZXN0YXJ0QnRuIiwib3ZlcmxheSIsInF1ZXJ5U2VsZWN0b3IiLCJib2FyZCIsImlzQ29tcHV0ZXJYIiwiY3VycmVudFBsYXllciIsImNvbXB1dGVyUGxheWVyIiwid2lubmluZ0NvbWJvcyIsImluaXRpYWxpemVHYW1lIiwiZm9yRWFjaCIsImNlbGwiLCJ0ZXh0Q29udGVudCIsImNsYXNzTGlzdCIsInJlbW92ZSIsInNldFRpbWVvdXQiLCJiZXN0TW92ZSIsImNoZWNrV2lubmVyIiwicGxheWVyIiwic29tZSIsImNvbWJvIiwiZXZlcnkiLCJpbmRleCIsImlzRHJhdyIsImJlc3RTY29yZSIsIkluZmluaXR5IiwibW92ZSIsImkiLCJsZW5ndGgiLCJzY29yZSIsIm1pbmltYXgiLCJhZGQiLCJzaG93UG9wdXAiLCJlbmRHYW1lIiwiZGVwdGgiLCJpc01heGltaXppbmciLCJNYXRoIiwibWF4IiwibWluIiwiaGFuZGxlQ2VsbENsaWNrIiwiZSIsInRhcmdldCIsImRhdGFzZXQiLCJhZGRFdmVudExpc3RlbmVyIiwicG9wdXAiLCJjb25zb2xlIiwibG9nIiwiaGlkZVBvcHVwIl0sIm1hcHBpbmdzIjoiOztBQUFBLElBQU1BLEtBQUssR0FBR0MsUUFBUSxDQUFDQyxnQkFBZ0IsQ0FBQyxPQUFPLENBQUM7QUFDaEQsSUFBTUMsVUFBVSxHQUFHRixRQUFRLENBQUNHLGNBQWMsQ0FBQyxRQUFRLENBQUM7QUFDcEQsSUFBTUMsVUFBVSxHQUFHSixRQUFRLENBQUNHLGNBQWMsQ0FBQyxTQUFTLENBQUM7QUFDckQsSUFBTUUsT0FBTyxHQUFHTCxRQUFRLENBQUNNLGFBQWEsQ0FBQyxVQUFVLENBQUM7QUFFbEQsSUFBSUMsS0FBSyxHQUFHLENBQUMsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLENBQUM7QUFDaEQsSUFBSUMsV0FBVyxHQUFHLElBQUksQ0FBQyxDQUFDO0FBQ3hCLElBQUlDLGFBQWEsRUFBRUMsY0FBYztBQUVqQyxJQUFNQyxhQUFhLEdBQUcsQ0FDbEIsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUNULENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsRUFDVCxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQ1QsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUNULENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsRUFDVCxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQ1QsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUNULENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FDWjtBQUVELFNBQVNDLGNBQWMsR0FBRztFQUN0QkgsYUFBYSxHQUFHRCxXQUFXLEdBQUcsR0FBRyxHQUFHLEdBQUc7RUFDdkNFLGNBQWMsR0FBR0YsV0FBVyxHQUFHLEdBQUcsR0FBRyxHQUFHO0VBQ3hDRCxLQUFLLEdBQUcsQ0FBQyxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsQ0FBQztFQUM1Q1IsS0FBSyxDQUFDYyxPQUFPLENBQUMsVUFBQUMsSUFBSSxFQUFJO0lBQ2xCQSxJQUFJLENBQUNDLFdBQVcsR0FBRyxFQUFFO0lBQ3JCRCxJQUFJLENBQUNFLFNBQVMsQ0FBQ0MsTUFBTSxDQUFDLE9BQU8sQ0FBQztFQUNsQyxDQUFDLENBQUM7RUFDRmYsVUFBVSxDQUFDYSxXQUFXLG9EQUFlTixhQUFhLE1BQUc7RUFDckQsSUFBSUEsYUFBYSxLQUFLQyxjQUFjLEVBQUU7SUFDbENRLFVBQVUsQ0FBQ0MsUUFBUSxFQUFFLEdBQUcsQ0FBQztFQUM3QjtBQUNKO0FBRUEsU0FBU0MsV0FBVyxDQUFDQyxNQUFNLEVBQUU7RUFDekIsT0FBT1YsYUFBYSxDQUFDVyxJQUFJLENBQUMsVUFBQUMsS0FBSztJQUFBLE9BQzNCQSxLQUFLLENBQUNDLEtBQUssQ0FBQyxVQUFBQyxLQUFLO01BQUEsT0FBSWxCLEtBQUssQ0FBQ2tCLEtBQUssQ0FBQyxLQUFLSixNQUFNO0lBQUEsRUFBQztFQUFBLEVBQ2hEO0FBQ0w7QUFFQSxTQUFTSyxNQUFNLEdBQUc7RUFDZCxPQUFPbkIsS0FBSyxDQUFDaUIsS0FBSyxDQUFDLFVBQUFWLElBQUk7SUFBQSxPQUFJQSxJQUFJLEtBQUssRUFBRTtFQUFBLEVBQUM7QUFDM0M7QUFFQSxTQUFTSyxRQUFRLEdBQUc7RUFDaEIsSUFBSVEsU0FBUyxHQUFHLENBQUNDLFFBQVE7RUFDekIsSUFBSUMsSUFBSTtFQUVSLEtBQUssSUFBSUMsQ0FBQyxHQUFHLENBQUMsRUFBRUEsQ0FBQyxHQUFHdkIsS0FBSyxDQUFDd0IsTUFBTSxFQUFFRCxDQUFDLEVBQUUsRUFBRTtJQUNuQyxJQUFJdkIsS0FBSyxDQUFDdUIsQ0FBQyxDQUFDLEtBQUssRUFBRSxFQUFFO01BQ2pCdkIsS0FBSyxDQUFDdUIsQ0FBQyxDQUFDLEdBQUdwQixjQUFjO01BQ3pCLElBQUlzQixLQUFLLEdBQUdDLE9BQU8sQ0FBQzFCLEtBQUssRUFBRSxDQUFDLEVBQUUsS0FBSyxDQUFDO01BQ3BDQSxLQUFLLENBQUN1QixDQUFDLENBQUMsR0FBRyxFQUFFO01BQ2IsSUFBSUUsS0FBSyxHQUFHTCxTQUFTLEVBQUU7UUFDbkJBLFNBQVMsR0FBR0ssS0FBSztRQUNqQkgsSUFBSSxHQUFHQyxDQUFDO01BQ1o7SUFDSjtFQUNKO0VBQ0F2QixLQUFLLENBQUNzQixJQUFJLENBQUMsR0FBR25CLGNBQWM7RUFDNUJYLEtBQUssQ0FBQzhCLElBQUksQ0FBQyxDQUFDZCxXQUFXLEdBQUdMLGNBQWM7RUFDeENYLEtBQUssQ0FBQzhCLElBQUksQ0FBQyxDQUFDYixTQUFTLENBQUNrQixHQUFHLENBQUMsT0FBTyxDQUFDO0VBQ2xDLElBQUlkLFdBQVcsQ0FBQ1YsY0FBYyxDQUFDLEVBQUU7SUFDN0JSLFVBQVUsQ0FBQ2EsV0FBVyxnRUFBaUJMLGNBQWMsNENBQVc7SUFDaEV5QixTQUFTLENBQUMsUUFBUSxDQUFDO0lBQ25CQyxPQUFPLEVBQUU7RUFDYixDQUFDLE1BQU0sSUFBSVYsTUFBTSxFQUFFLEVBQUU7SUFDakJ4QixVQUFVLENBQUNhLFdBQVcsR0FBRyxRQUFRO0lBQ2pDb0IsU0FBUyxDQUFDLFFBQVEsQ0FBQztFQUN2QixDQUFDLE1BQU07SUFDSDFCLGFBQWEsR0FBR0EsYUFBYSxLQUFLLEdBQUcsR0FBRyxHQUFHLEdBQUcsR0FBRztJQUNqRFAsVUFBVSxDQUFDYSxXQUFXLG9EQUFlTixhQUFhLE1BQUc7RUFDekQ7QUFDSjtBQUVBLFNBQVN3QixPQUFPLENBQUMxQixLQUFLLEVBQUU4QixLQUFLLEVBQUVDLFlBQVksRUFBRTtFQUN6QyxJQUFJbEIsV0FBVyxDQUFDVixjQUFjLENBQUMsRUFBRSxPQUFPLEVBQUUsR0FBRzJCLEtBQUssQ0FBQyxDQUFDO0VBQ3BELElBQUlqQixXQUFXLENBQUNYLGFBQWEsQ0FBQyxFQUFFLE9BQU80QixLQUFLLEdBQUcsRUFBRSxDQUFDLENBQUM7RUFDbkQsSUFBSVgsTUFBTSxFQUFFLEVBQUUsT0FBTyxDQUFDLENBQUMsQ0FBQzs7RUFFeEIsSUFBSVksWUFBWSxFQUFFO0lBQ2QsSUFBSVgsU0FBUyxHQUFHLENBQUNDLFFBQVE7SUFDekIsS0FBSyxJQUFJRSxDQUFDLEdBQUcsQ0FBQyxFQUFFQSxDQUFDLEdBQUd2QixLQUFLLENBQUN3QixNQUFNLEVBQUVELENBQUMsRUFBRSxFQUFFO01BQ25DLElBQUl2QixLQUFLLENBQUN1QixDQUFDLENBQUMsS0FBSyxFQUFFLEVBQUU7UUFDakJ2QixLQUFLLENBQUN1QixDQUFDLENBQUMsR0FBR3BCLGNBQWM7UUFDekIsSUFBSXNCLEtBQUssR0FBR0MsT0FBTyxDQUFDMUIsS0FBSyxFQUFFOEIsS0FBSyxHQUFHLENBQUMsRUFBRSxLQUFLLENBQUM7UUFDNUM5QixLQUFLLENBQUN1QixDQUFDLENBQUMsR0FBRyxFQUFFO1FBQ2JILFNBQVMsR0FBR1ksSUFBSSxDQUFDQyxHQUFHLENBQUNSLEtBQUssRUFBRUwsU0FBUyxDQUFDO01BQzFDO0lBQ0o7SUFDQSxPQUFPQSxTQUFTO0VBQ3BCLENBQUMsTUFBTTtJQUNILElBQUlBLFVBQVMsR0FBR0MsUUFBUTtJQUN4QixLQUFLLElBQUlFLEVBQUMsR0FBRyxDQUFDLEVBQUVBLEVBQUMsR0FBR3ZCLEtBQUssQ0FBQ3dCLE1BQU0sRUFBRUQsRUFBQyxFQUFFLEVBQUU7TUFDbkMsSUFBSXZCLEtBQUssQ0FBQ3VCLEVBQUMsQ0FBQyxLQUFLLEVBQUUsRUFBRTtRQUNqQnZCLEtBQUssQ0FBQ3VCLEVBQUMsQ0FBQyxHQUFHckIsYUFBYTtRQUN4QixJQUFJdUIsTUFBSyxHQUFHQyxPQUFPLENBQUMxQixLQUFLLEVBQUU4QixLQUFLLEdBQUcsQ0FBQyxFQUFFLElBQUksQ0FBQztRQUMzQzlCLEtBQUssQ0FBQ3VCLEVBQUMsQ0FBQyxHQUFHLEVBQUU7UUFDYkgsVUFBUyxHQUFHWSxJQUFJLENBQUNFLEdBQUcsQ0FBQ1QsTUFBSyxFQUFFTCxVQUFTLENBQUM7TUFDMUM7SUFDSjtJQUNBLE9BQU9BLFVBQVM7RUFDcEI7QUFDSjtBQUVBLFNBQVNlLGVBQWUsQ0FBQ0MsQ0FBQyxFQUFFO0VBQ3hCLElBQU03QixJQUFJLEdBQUc2QixDQUFDLENBQUNDLE1BQU07RUFDckIsSUFBTW5CLEtBQUssR0FBR1gsSUFBSSxDQUFDK0IsT0FBTyxDQUFDcEIsS0FBSztFQUVoQyxJQUFJbEIsS0FBSyxDQUFDa0IsS0FBSyxDQUFDLEtBQUssRUFBRSxJQUFJaEIsYUFBYSxLQUFLQyxjQUFjLEVBQUU7SUFDekRILEtBQUssQ0FBQ2tCLEtBQUssQ0FBQyxHQUFHaEIsYUFBYTtJQUM1QkssSUFBSSxDQUFDQyxXQUFXLEdBQUdOLGFBQWE7SUFDaENLLElBQUksQ0FBQ0UsU0FBUyxDQUFDa0IsR0FBRyxDQUFDLE9BQU8sQ0FBQztJQUUzQixJQUFJZCxXQUFXLENBQUNYLGFBQWEsQ0FBQyxFQUFFO01BQzVCUCxVQUFVLENBQUNhLFdBQVcsMkJBQVVOLGFBQWEsa0RBQVk7TUFDekQwQixTQUFTLENBQUMsT0FBTyxDQUFDO01BQ2xCQyxPQUFPLEVBQUU7SUFDYixDQUFDLE1BQU0sSUFBSVYsTUFBTSxFQUFFLEVBQUU7TUFDakJ4QixVQUFVLENBQUNhLFdBQVcsR0FBRyxRQUFRO0lBQ3JDLENBQUMsTUFBTTtNQUNITixhQUFhLEdBQUdDLGNBQWM7TUFDOUJSLFVBQVUsQ0FBQ2EsV0FBVyx5RkFBc0JMLGNBQWMsTUFBRztNQUM3RFEsVUFBVSxDQUFDQyxRQUFRLEVBQUUsR0FBRyxDQUFDO0lBQzdCO0VBQ0o7QUFDSjtBQUVBLFNBQVNpQixPQUFPLEdBQUc7RUFDZnJDLEtBQUssQ0FBQ2MsT0FBTyxDQUFDLFVBQUFDLElBQUk7SUFBQSxPQUFJQSxJQUFJLENBQUNFLFNBQVMsQ0FBQ2tCLEdBQUcsQ0FBQyxPQUFPLENBQUM7RUFBQSxFQUFDO0FBQ3REO0FBRUE5QixVQUFVLENBQUMwQyxnQkFBZ0IsQ0FBQyxPQUFPLEVBQUUsWUFBTTtFQUN2Q3RDLFdBQVcsR0FBRyxDQUFDQSxXQUFXLENBQUMsQ0FBQztFQUM1QkksY0FBYyxFQUFFO0FBQ3BCLENBQUMsQ0FBQztBQUVGYixLQUFLLENBQUNjLE9BQU8sQ0FBQyxVQUFBQyxJQUFJO0VBQUEsT0FBSUEsSUFBSSxDQUFDZ0MsZ0JBQWdCLENBQUMsT0FBTyxFQUFFSixlQUFlLENBQUM7QUFBQSxFQUFDO0FBRXRFOUIsY0FBYyxFQUFFO0FBRWhCLFNBQVN1QixTQUFTLENBQUNZLEtBQUssRUFBQztFQUNyQkMsT0FBTyxDQUFDQyxHQUFHLENBQUNGLEtBQUssQ0FBQztFQUNsQkEsS0FBSyxHQUFHMUMsT0FBTyxDQUFDQyxhQUFhLENBQUN5QyxLQUFLLENBQUM7RUFFcEMxQyxPQUFPLENBQUNXLFNBQVMsQ0FBQ0MsTUFBTSxDQUFDLFNBQVMsQ0FBQztFQUNuQzhCLEtBQUssQ0FBQy9CLFNBQVMsQ0FBQ0MsTUFBTSxDQUFDLE1BQU0sQ0FBQztBQUNsQztBQUVBLFNBQVNpQyxTQUFTLENBQUNILEtBQUssRUFBQztFQUNyQkEsS0FBSyxHQUFHMUMsT0FBTyxDQUFDQyxhQUFhLENBQUN5QyxLQUFLLENBQUM7RUFDcEMxQyxPQUFPLENBQUNXLFNBQVMsQ0FBQ2tCLEdBQUcsQ0FBQyxTQUFTLENBQUM7RUFDaENhLEtBQUssQ0FBQy9CLFNBQVMsQ0FBQ2tCLEdBQUcsQ0FBQyxNQUFNLENBQUM7QUFDL0IiLCJmaWxlIjoibWFpbi5qcyIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IGNlbGxzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmNlbGwnKTtcbmNvbnN0IHN0YXR1c1RleHQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3RhdHVzJyk7XG5jb25zdCByZXN0YXJ0QnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhcnQnKTtcbmNvbnN0IG92ZXJsYXkgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLm92ZXJsYXlcIik7XG5cbmxldCBib2FyZCA9IFsnJywgJycsICcnLCAnJywgJycsICcnLCAnJywgJycsICcnXTtcbmxldCBpc0NvbXB1dGVyWCA9IHRydWU7IC8vINCn0LXRgNC10LTRg9GUINGA0L7Qu9GMINC60L7QvNC/J9GO0YLQtdGA0LAg0LzRltC2IFgg0YLQsCBPXG5sZXQgY3VycmVudFBsYXllciwgY29tcHV0ZXJQbGF5ZXI7XG5cbmNvbnN0IHdpbm5pbmdDb21ib3MgPSBbXG4gICAgWzAsIDEsIDJdLFxuICAgIFszLCA0LCA1XSxcbiAgICBbNiwgNywgOF0sXG4gICAgWzAsIDMsIDZdLFxuICAgIFsxLCA0LCA3XSxcbiAgICBbMiwgNSwgOF0sXG4gICAgWzAsIDQsIDhdLFxuICAgIFsyLCA0LCA2XSxcbl07XG5cbmZ1bmN0aW9uIGluaXRpYWxpemVHYW1lKCkge1xuICAgIGN1cnJlbnRQbGF5ZXIgPSBpc0NvbXB1dGVyWCA/ICdPJyA6ICdYJztcbiAgICBjb21wdXRlclBsYXllciA9IGlzQ29tcHV0ZXJYID8gJ1gnIDogJ08nO1xuICAgIGJvYXJkID0gWycnLCAnJywgJycsICcnLCAnJywgJycsICcnLCAnJywgJyddO1xuICAgIGNlbGxzLmZvckVhY2goY2VsbCA9PiB7XG4gICAgICAgIGNlbGwudGV4dENvbnRlbnQgPSAnJztcbiAgICAgICAgY2VsbC5jbGFzc0xpc3QucmVtb3ZlKCd0YWtlbicpO1xuICAgIH0pO1xuICAgIHN0YXR1c1RleHQudGV4dENvbnRlbnQgPSBg0JLQsNGIINGF0ZbQtCAoJHtjdXJyZW50UGxheWVyfSlgO1xuICAgIGlmIChjdXJyZW50UGxheWVyID09PSBjb21wdXRlclBsYXllcikge1xuICAgICAgICBzZXRUaW1lb3V0KGJlc3RNb3ZlLCA1MDApO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gY2hlY2tXaW5uZXIocGxheWVyKSB7XG4gICAgcmV0dXJuIHdpbm5pbmdDb21ib3Muc29tZShjb21ibyA9PlxuICAgICAgICBjb21iby5ldmVyeShpbmRleCA9PiBib2FyZFtpbmRleF0gPT09IHBsYXllcilcbiAgICApO1xufVxuXG5mdW5jdGlvbiBpc0RyYXcoKSB7XG4gICAgcmV0dXJuIGJvYXJkLmV2ZXJ5KGNlbGwgPT4gY2VsbCAhPT0gJycpO1xufVxuXG5mdW5jdGlvbiBiZXN0TW92ZSgpIHtcbiAgICBsZXQgYmVzdFNjb3JlID0gLUluZmluaXR5O1xuICAgIGxldCBtb3ZlO1xuXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBib2FyZC5sZW5ndGg7IGkrKykge1xuICAgICAgICBpZiAoYm9hcmRbaV0gPT09ICcnKSB7XG4gICAgICAgICAgICBib2FyZFtpXSA9IGNvbXB1dGVyUGxheWVyO1xuICAgICAgICAgICAgbGV0IHNjb3JlID0gbWluaW1heChib2FyZCwgMCwgZmFsc2UpO1xuICAgICAgICAgICAgYm9hcmRbaV0gPSAnJztcbiAgICAgICAgICAgIGlmIChzY29yZSA+IGJlc3RTY29yZSkge1xuICAgICAgICAgICAgICAgIGJlc3RTY29yZSA9IHNjb3JlO1xuICAgICAgICAgICAgICAgIG1vdmUgPSBpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIGJvYXJkW21vdmVdID0gY29tcHV0ZXJQbGF5ZXI7XG4gICAgY2VsbHNbbW92ZV0udGV4dENvbnRlbnQgPSBjb21wdXRlclBsYXllcjtcbiAgICBjZWxsc1ttb3ZlXS5jbGFzc0xpc3QuYWRkKCd0YWtlbicpO1xuICAgIGlmIChjaGVja1dpbm5lcihjb21wdXRlclBsYXllcikpIHtcbiAgICAgICAgc3RhdHVzVGV4dC50ZXh0Q29udGVudCA9IGDQmtC+0LzQvyfRjtGC0LXRgCAoJHtjb21wdXRlclBsYXllcn0pINCy0LjQs9GA0LDQsiFgO1xuICAgICAgICBzaG93UG9wdXAoXCIuX2xvc2VcIilcbiAgICAgICAgZW5kR2FtZSgpO1xuICAgIH0gZWxzZSBpZiAoaXNEcmF3KCkpIHtcbiAgICAgICAgc3RhdHVzVGV4dC50ZXh0Q29udGVudCA9IFwi0J3RltGH0LjRjyFcIjtcbiAgICAgICAgc2hvd1BvcHVwKFwiLl9kcmF3XCIpXG4gICAgfSBlbHNlIHtcbiAgICAgICAgY3VycmVudFBsYXllciA9IGN1cnJlbnRQbGF5ZXIgPT09ICdYJyA/ICdPJyA6ICdYJztcbiAgICAgICAgc3RhdHVzVGV4dC50ZXh0Q29udGVudCA9IGDQktCw0Ygg0YXRltC0ICgke2N1cnJlbnRQbGF5ZXJ9KWA7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBtaW5pbWF4KGJvYXJkLCBkZXB0aCwgaXNNYXhpbWl6aW5nKSB7XG4gICAgaWYgKGNoZWNrV2lubmVyKGNvbXB1dGVyUGxheWVyKSkgcmV0dXJuIDEwIC0gZGVwdGg7IC8vINCa0L7QvNC/J9GO0YLQtdGAINCy0LjQs9GA0LDQslxuICAgIGlmIChjaGVja1dpbm5lcihjdXJyZW50UGxheWVyKSkgcmV0dXJuIGRlcHRoIC0gMTA7IC8vINCT0YDQsNCy0LXRhtGMINCy0LjQs9GA0LDQslxuICAgIGlmIChpc0RyYXcoKSkgcmV0dXJuIDA7IC8vINCd0ZbRh9C40Y9cblxuICAgIGlmIChpc01heGltaXppbmcpIHtcbiAgICAgICAgbGV0IGJlc3RTY29yZSA9IC1JbmZpbml0eTtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBib2FyZC5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgaWYgKGJvYXJkW2ldID09PSAnJykge1xuICAgICAgICAgICAgICAgIGJvYXJkW2ldID0gY29tcHV0ZXJQbGF5ZXI7XG4gICAgICAgICAgICAgICAgbGV0IHNjb3JlID0gbWluaW1heChib2FyZCwgZGVwdGggKyAxLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgYm9hcmRbaV0gPSAnJztcbiAgICAgICAgICAgICAgICBiZXN0U2NvcmUgPSBNYXRoLm1heChzY29yZSwgYmVzdFNjb3JlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYmVzdFNjb3JlO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIGxldCBiZXN0U2NvcmUgPSBJbmZpbml0eTtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBib2FyZC5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgaWYgKGJvYXJkW2ldID09PSAnJykge1xuICAgICAgICAgICAgICAgIGJvYXJkW2ldID0gY3VycmVudFBsYXllcjtcbiAgICAgICAgICAgICAgICBsZXQgc2NvcmUgPSBtaW5pbWF4KGJvYXJkLCBkZXB0aCArIDEsIHRydWUpO1xuICAgICAgICAgICAgICAgIGJvYXJkW2ldID0gJyc7XG4gICAgICAgICAgICAgICAgYmVzdFNjb3JlID0gTWF0aC5taW4oc2NvcmUsIGJlc3RTY29yZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGJlc3RTY29yZTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIGhhbmRsZUNlbGxDbGljayhlKSB7XG4gICAgY29uc3QgY2VsbCA9IGUudGFyZ2V0O1xuICAgIGNvbnN0IGluZGV4ID0gY2VsbC5kYXRhc2V0LmluZGV4O1xuXG4gICAgaWYgKGJvYXJkW2luZGV4XSA9PT0gJycgJiYgY3VycmVudFBsYXllciAhPT0gY29tcHV0ZXJQbGF5ZXIpIHtcbiAgICAgICAgYm9hcmRbaW5kZXhdID0gY3VycmVudFBsYXllcjtcbiAgICAgICAgY2VsbC50ZXh0Q29udGVudCA9IGN1cnJlbnRQbGF5ZXI7XG4gICAgICAgIGNlbGwuY2xhc3NMaXN0LmFkZCgndGFrZW4nKTtcblxuICAgICAgICBpZiAoY2hlY2tXaW5uZXIoY3VycmVudFBsYXllcikpIHtcbiAgICAgICAgICAgIHN0YXR1c1RleHQudGV4dENvbnRlbnQgPSBg0JLQuCAoJHtjdXJyZW50UGxheWVyfSkg0LLQuNCz0YDQsNC70LghYDtcbiAgICAgICAgICAgIHNob3dQb3B1cChcIi5fd2luXCIpXG4gICAgICAgICAgICBlbmRHYW1lKCk7XG4gICAgICAgIH0gZWxzZSBpZiAoaXNEcmF3KCkpIHtcbiAgICAgICAgICAgIHN0YXR1c1RleHQudGV4dENvbnRlbnQgPSBcItCd0ZbRh9C40Y8hXCI7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjdXJyZW50UGxheWVyID0gY29tcHV0ZXJQbGF5ZXI7XG4gICAgICAgICAgICBzdGF0dXNUZXh0LnRleHRDb250ZW50ID0gYNCl0ZbQtCDQutC+0LzQvyfRjtGC0LXRgNCwICgke2NvbXB1dGVyUGxheWVyfSlgO1xuICAgICAgICAgICAgc2V0VGltZW91dChiZXN0TW92ZSwgNTAwKTtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuZnVuY3Rpb24gZW5kR2FtZSgpIHtcbiAgICBjZWxscy5mb3JFYWNoKGNlbGwgPT4gY2VsbC5jbGFzc0xpc3QuYWRkKCd0YWtlbicpKTtcbn1cblxucmVzdGFydEJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICBpc0NvbXB1dGVyWCA9ICFpc0NvbXB1dGVyWDsgLy8g0KfQtdGA0LXQtNGD0ZTQvNC+INGA0L7Qu9GWXG4gICAgaW5pdGlhbGl6ZUdhbWUoKTtcbn0pO1xuXG5jZWxscy5mb3JFYWNoKGNlbGwgPT4gY2VsbC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGhhbmRsZUNlbGxDbGljaykpO1xuXG5pbml0aWFsaXplR2FtZSgpO1xuXG5mdW5jdGlvbiBzaG93UG9wdXAocG9wdXApe1xuICAgIGNvbnNvbGUubG9nKHBvcHVwKVxuICAgIHBvcHVwID0gb3ZlcmxheS5xdWVyeVNlbGVjdG9yKHBvcHVwKVxuXG4gICAgb3ZlcmxheS5jbGFzc0xpc3QucmVtb3ZlKFwib3BhY2l0eVwiKVxuICAgIHBvcHVwLmNsYXNzTGlzdC5yZW1vdmUoXCJoaWRlXCIpXG59XG5cbmZ1bmN0aW9uIGhpZGVQb3B1cChwb3B1cCl7XG4gICAgcG9wdXAgPSBvdmVybGF5LnF1ZXJ5U2VsZWN0b3IocG9wdXApXG4gICAgb3ZlcmxheS5jbGFzc0xpc3QuYWRkKFwib3BhY2l0eVwiKVxuICAgIHBvcHVwLmNsYXNzTGlzdC5hZGQoXCJoaWRlXCIpXG59Il19
